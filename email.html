<!DOCTYPE html>
<html lang="en-US" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free USA Temporary Email | Disposable Email Address | More Mail</title>
    
    <!-- Enhanced SEO Meta Tags for USA Audience -->
    <meta name="description" content="Get a free, secure temporary email address instantly. Perfect for US users. Protect your privacy, avoid spam, and sign up for services without revealing your personal email. No registration required.">
    <meta name="keywords" content="free temporary email usa, disposable email, fake email, throwaway email, temp mail, anonymous email, 10 minute mail, usa email service, privacy protection, spam prevention, no signup email, temporary email for signing up">
    <meta name="author" content="More Mail">
    <meta name="robots" content="index, follow">
    <meta name="language" content="English">
    <meta name="geo.region" content="US" />
    <meta name="geo.country" content="United States" />
    <link rel="canonical" href="https://moremail.app">
    
    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="Free USA Temporary Email | Disposable Email Address">
    <meta property="og:description" content="Protect your privacy with a free, instant temporary email. No signup, no hassle. The #1 choice for users in USA.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://moremail.app">
    <meta property="og:site_name" content="More Mail">
    <meta property="og:locale" content="en_US">
    <meta property="og:image" content="https://moremail.app/og-image.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free USA Temporary Email | More Mail">
    <meta name="twitter:description" content="Get a secure, disposable email address in seconds. Perfect for privacy-conscious users in USA.">
    <meta name="twitter:image" content="https://moremail.app/twitter-image.jpg">
    <meta name="twitter:site" content="@moremailapp">
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“§</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“§</text></svg>">
    
    <!-- Enhanced Structured Data (JSON-LD) for USA -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "More Mail",
        "description": "The leading free temporary and disposable email service for users in USA. Get a secure email address instantly without any registration.",
        "url": "https://moremail.app",
        "applicationCategory": "CommunicationApplication",
        "operatingSystem": "Any",
        "browserRequirements": "Requires JavaScript. Requires HTML5.",
        "offers": {
            "@type": "Offer",
            "price": "0",
            "priceCurrency": "USD",
            "availability": "https://schema.org/InStock"
        },
        "provider": {
            "@type": "Organization",
            "name": "More Mail",
            "url": "https://moremail.app",
            "address": {
                "@type": "PostalAddress",
                "addressCountry": "US"
            }
        },
        "featureList": [
            "Free temporary email addresses",
            "No registration or signup required",
            "Instant email generation",
            "Privacy and anonymity protection",
            "Spam prevention",
            "Mobile-friendly and responsive design",
            "Secure and reliable service",
            "Perfect for US-based users"
        ],
        "aggregateRating": {
            "@type": "AggregateRating",
            "ratingValue": "4.8",
            "reviewCount": "1250"
        }
    }
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <style>
        body { font-family: 'Space Grotesk', sans-serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .modal-backdrop { backdrop-filter: blur(4px); }
        
        /* Fix for text overflow in inbox */
        .line-clamp-1 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 1;
        }
        .line-clamp-2 {
            overflow: hidden;
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
        }
        
        /* Email content styling - improved */
        .email-content-container {
            -ms-overflow-style: none;  /* IE and Edge */
            scrollbar-width: thin;  /* Firefox */
        }
        .email-content-container::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        .prose a {
            color: #2563eb;
            text-decoration: underline;
        }

        .dark .prose a {
            color: #60a5fa;
        }

        .prose img {
            max-width: 100%;
            height: auto;
            border-radius: 0.375rem;
        }

        /* Ensure text doesn't overflow container */
        .prose p, .prose div {
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .prose table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .prose th, .prose td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: left;
        }

        .dark .prose th, .dark .prose td {
            border-color: #374151;
        }
        
        /* Email content styling */
        .email-content {
            font-size: 14px;
            line-height: 1.6;
            color: #374151;
        }
        .dark .email-content {
            color: #D1D5DB;
        }
        .email-content p {
            margin-bottom: 12px;
        }
        .email-content a {
            color: #3B82F6;
            text-decoration: underline;
        }
        .dark .email-content a {
            color: #60A5FA;
        }
    </style>
</head>
<body class="h-full bg-gray-50 dark:bg-slate-900 text-gray-900 dark:text-gray-100">
    <!-- Home Screen -->
    <div id="homeScreen" class="hidden h-full flex flex-col">
        <!-- Header -->
        <header class="bg-white dark:bg-slate-800 shadow-sm px-4 py-3 flex items-center justify-between">
            <div class="flex items-center flex-1">
                <div class="w-10 h-10 bg-gradient-to-br from-amber-400 to-amber-600 rounded-xl flex items-center justify-center mr-3 shadow-md">
                    <span class="text-xl">ðŸ“§</span>
                </div>
                <h1 class="text-xl font-semibold text-amber-600 dark:text-amber-400">More Mail</h1>
            </div>
            <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                <span class="material-symbols-outlined text-2xl" id="themeIcon">ðŸŒ™</span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-hidden flex flex-col px-4 py-4">
            <!-- Action Buttons -->
            <div class="flex gap-3 mb-4">
                <button id="changeMailBtn" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white font-medium py-3 px-4 rounded-lg shadow-md transition-all">
                    Change Mail
                </button>
                <button id="deleteMailBtn" class="flex-1 bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg shadow-md transition-all">
                    Delete Mail
                </button>
            </div>

            <!-- Email Display Card -->
            <div class="bg-white dark:bg-slate-800 rounded-xl shadow-lg p-4 mb-4">
                <div class="flex items-center">
                    <p id="emailAddress" class="text-lg font-medium flex-1 mr-2 text-gray-900 dark:text-gray-100">Loading...</p>
                    <button id="copyBtn" class="p-2 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-lg hover:bg-amber-200 dark:hover:bg-amber-900/50 transition-colors">
                        <span class="material-symbols-outlined">content_copy</span>
                    </button>
                </div>
            </div>

            <!-- Inbox Section -->
            <div class="flex-1 bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden flex flex-col">
                <div class="p-4 border-b border-gray-200 dark:border-slate-700 flex items-center justify-between">
                    <h2 class="text-lg font-medium text-gray-900 dark:text-gray-100">Inbox</h2>
                    <button id="refreshBtn" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors">
                        <span class="material-symbols-outlined">refresh</span>
                    </button>
                </div>
                <div id="inboxContainer" class="flex-1 overflow-y-auto no-scrollbar">
                    <div id="emptyInbox" class="flex flex-col items-center justify-center h-full p-8 text-center">
                        <span class="material-symbols-outlined text-6xl text-gray-300 dark:text-slate-600 mb-4">inbox</span>
                        <p class="text-gray-500 dark:text-slate-400">Your inbox is empty...</p>
                    </div>
                    <div id="emailList" class="hidden"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Email Details Screen -->
    <div id="emailDetailsScreen" class="hidden h-full flex flex-col bg-green-50 dark:bg-slate-900">
        <!-- Header -->
        <header class="bg-white dark:bg-slate-800 shadow-sm px-4 py-3 flex items-center">
            <button id="backBtn" class="p-2 rounded-full hover:bg-gray-100 dark:hover:bg-slate-700 transition-colors mr-3">
                <span class="material-symbols-outlined text-gray-700 dark:text-gray-300">arrow_back</span>
            </button>
            <h1 class="text-lg font-medium text-gray-900 dark:text-gray-100">Email Details</h1>
        </header>

        <!-- Email Content -->
        <div id="emailContent" class="flex-1 overflow-y-auto p-4">
            <!-- Email details will be dynamically added here -->
        </div>

        <!-- Delete Button -->
        <div class="p-4 bg-white dark:bg-slate-800 shadow-lg">
            <button id="deleteMessageBtn" class="w-full bg-red-500 hover:bg-red-600 text-white font-medium py-3 px-4 rounded-lg shadow-md transition-all">
                Delete Message
            </button>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmModal" class="hidden fixed inset-0 z-50 flex items-center justify-center p-4">
        <div class="modal-backdrop absolute inset-0 bg-black/50" onclick="closeConfirmModal()"></div>
        <div class="relative bg-white dark:bg-slate-800 rounded-xl shadow-2xl p-6 max-w-sm w-full">
            <div class="text-center">
                <h3 class="text-xl font-semibold mb-2 text-gray-900 dark:text-gray-100">Change Email Address?</h3>
                <p class="text-gray-600 dark:text-slate-400 mb-6">Are you sure you want to change your email address? Your current email and all messages will be permanently deleted.</p>
                <div class="flex gap-3">
                    <button id="cancelChangeBtn" class="flex-1 bg-gray-200 dark:bg-slate-700 hover:bg-gray-300 dark:hover:bg-slate-600 text-gray-800 dark:text-gray-200 font-medium py-3 px-4 rounded-lg transition-colors">
                        Cancel
                    </button>
                    <button id="confirmChangeBtn" class="flex-1 bg-amber-500 hover:bg-amber-600 text-white font-medium py-3 px-4 rounded-lg transition-colors">
                        Yes, Change
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="fixed bottom-4 left-0 right-0 z-50 flex flex-col items-center gap-2 px-4"></div>

    <script>
        // App State
        let currentEmail = '';
        let jwtToken = '';
        let emails = [];
        let currentEmailDetails = null; // To store email being viewed
        let fetchInterval = null;

        // DOM Elements
        const homeScreen = document.getElementById('homeScreen');
        const emailDetailsScreen = document.getElementById('emailDetailsScreen');
        const confirmModal = document.getElementById('confirmModal');
        const themeToggle = document.getElementById('themeToggle');
        const themeIcon = document.getElementById('themeIcon');
        const changeMailBtn = document.getElementById('changeMailBtn');
        const deleteMailBtn = document.getElementById('deleteMailBtn');
        const copyBtn = document.getElementById('copyBtn');
        const refreshBtn = document.getElementById('refreshBtn');
        const backBtn = document.getElementById('backBtn');
        const deleteMessageBtn = document.getElementById('deleteMessageBtn');
        const cancelChangeBtn = document.getElementById('cancelChangeBtn');
        const confirmChangeBtn = document.getElementById('confirmChangeBtn');
        const emailAddress = document.getElementById('emailAddress');
        const emptyInbox = document.getElementById('emptyInbox');
        const emailList = document.getElementById('emailList');
        const emailContent = document.getElementById('emailContent');
        const toastContainer = document.getElementById('toastContainer');

        // Initialize App
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Loaded. Initializing app.");
            
            // Set initial theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.classList.add('dark');
                themeIcon.textContent = 'â˜€ï¸';
            } else {
                themeIcon.textContent = 'ðŸŒ™';
            }
            
            homeScreen.classList.remove('hidden');
            initializeApp();

            // Event Listeners
            themeToggle.addEventListener('click', toggleTheme);
            changeMailBtn.addEventListener('click', showConfirmModal);
            deleteMailBtn.addEventListener('click', deleteCurrentEmail);
            copyBtn.addEventListener('click', copyToClipboard);
            refreshBtn.addEventListener('click', fetchEmails);
            backBtn.addEventListener('click', showHomeScreen);
            deleteMessageBtn.addEventListener('click', deleteCurrentMessage);
            cancelChangeBtn.addEventListener('click', closeConfirmModal);
            confirmChangeBtn.addEventListener('click', confirmChangeEmail);
        });

        function toggleTheme() {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            themeIcon.textContent = isDark ? 'â˜€ï¸' : 'ðŸŒ™';
        }

        function showConfirmModal() {
            confirmModal.classList.remove('hidden');
            confirmModal.classList.add('flex');
        }

        function closeConfirmModal() {
            confirmModal.classList.add('hidden');
            confirmModal.classList.remove('flex');
        }

        async function confirmChangeEmail() {
            closeConfirmModal();
            await generateNewEmail();
        }

        function saveEmailData() {
            localStorage.setItem('moreMailData', JSON.stringify({ email: currentEmail, token: jwtToken }));
        }

        function loadEmailData() {
            const savedData = localStorage.getItem('moreMailData');
            return savedData ? JSON.parse(savedData) : null;
        }

        function clearEmailData() {
            localStorage.removeItem('moreMailData');
        }

        async function initializeApp() {
            console.log("initializeApp called");
            if (fetchInterval) clearInterval(fetchInterval);
            
            const savedData = loadEmailData();
            if (savedData && savedData.email && savedData.token) {
                console.log("Using saved data");
                currentEmail = savedData.email;
                jwtToken = savedData.token;
                updateEmailDisplay(currentEmail);
                await fetchEmails();
                fetchInterval = setInterval(fetchEmails, 5000);
            } else {
                console.log("No saved data, generating new email");
                await generateNewEmailInternal();
            }
        }

        async function generateNewEmailInternal() {
            console.log("generateNewEmailInternal called");
            try {
                const domainsResponse = await fetch('https://api.mail.tm/domains');
                if (!domainsResponse.ok) {
                    throw new Error('Failed to fetch domains');
                }
                const domains = await domainsResponse.json();
                if (domains['hydra:member'].length === 0) {
                    throw new Error('No domains available');
                }
                const randomDomain = domains['hydra:member'][0].domain;
                const username = Math.random().toString(36).substring(2, 10);
                currentEmail = `${username}@${randomDomain}`;
                updateEmailDisplay(currentEmail);
                
                const password = Math.random().toString(36).substring(2, 10) + "!";
                
                const accountResponse = await fetch('https://api.mail.tm/accounts', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ address: currentEmail, password: password })
                });
                
                if (accountResponse.ok) {
                    const authResponse = await fetch('https://api.mail.tm/token', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ address: currentEmail, password: password })
                    });
                    
                    if (authResponse.ok) {
                        const authData = await authResponse.json();
                        jwtToken = authData.token;
                        saveEmailData();
                        await fetchEmails();
                        fetchInterval = setInterval(fetchEmails, 5000);
                        showToast('Email created successfully', 'success');
                    } else {
                        const errorData = await authResponse.json();
                        showToast(`Authentication failed: ${errorData.message || 'Unknown error'}`, 'error');
                    }
                } else {
                    const errorData = await accountResponse.json();
                    showToast(`Account creation failed: ${errorData.message || 'Unknown error'}`, 'error');
                }
            } catch (error) {
                console.error('Error in generateNewEmailInternal:', error);
                showToast('Failed to generate new email. Please try again.', 'error');
            }
        }

        async function generateNewEmail() {
            if (fetchInterval) clearInterval(fetchInterval);
            clearEmailData();
            await generateNewEmailInternal();
        }

        async function deleteCurrentEmail() {
            if (!jwtToken) return;
            try {
                await fetch('https://api.mail.tm/me', {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${jwtToken}` }
                });
                showToast('Email deleted', 'success');
                await generateNewEmail();
            } catch (error) {
                console.error('Error deleting email:', error);
                showToast('Failed to delete email', 'error');
            }
        }

        async function fetchEmails() {
            if (!jwtToken) return;
            try {
                const response = await fetch('https://api.mail.tm/messages', {
                    headers: { 'Authorization': `Bearer ${jwtToken}` }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    emails = data['hydra:member'] || [];
                    updateEmailList();
                } else if (response.status === 401) {
                    showToast('Session expired. Generating new email.', 'warning');
                    clearEmailData();
                    await generateNewEmailInternal();
                } else {
                    const errorData = await response.json();
                    console.error('API Error:', errorData);
                }
            } catch (error) {
                console.error('Error fetching emails:', error);
            }
        }

        function updateEmailDisplay(email) {
            if(emailAddress) emailAddress.textContent = email;
        }

        function updateEmailList() {
            if (!emailList || !emptyInbox) return;

            if (emails.length > 0) {
                emptyInbox.classList.add('hidden');
                emailList.classList.remove('hidden');
                emailList.innerHTML = '';
                
                emails.slice().reverse().forEach(email => {
                    const emailItem = document.createElement('div');
                    emailItem.className = 'p-4 border-b border-gray-200 dark:border-slate-700 hover:bg-gray-50 dark:hover:bg-slate-700 cursor-pointer';
                    emailItem.innerHTML = `
                        <div class="flex items-start">
                            <div class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mr-3 flex-shrink-0">
                                <span class="text-amber-600 dark:text-amber-400 font-medium">${(email.from?.address || 'S').charAt(0).toUpperCase()}</span>
                            </div>
                            <div class="flex-1 min-w-0 overflow-hidden">
                                <p class="font-medium text-gray-900 dark:text-gray-100 truncate">${email.from?.address || 'Unknown Sender'}</p>
                                <p class="text-sm text-gray-700 dark:text-gray-300 truncate">${email.subject || '(No Subject)'}</p>
                                <p class="text-sm text-gray-600 dark:text-gray-400 line-clamp-2">${getEmailPreview(email.text || email.html)}</p>
                            </div>
                        </div>
                    `;
                    // Add click listener to open email details
                    emailItem.addEventListener('click', () => showEmailDetails(email));
                    emailList.appendChild(emailItem);
                });
            } else {
                emptyInbox.classList.remove('hidden');
                emailList.classList.add('hidden');
            }
        }
        
        // --- Email Details Functions ---

        function showHomeScreen() {
            emailDetailsScreen.classList.add('hidden');
            homeScreen.classList.remove('hidden');
        }

        async function showEmailDetails(email) {
            currentEmailDetails = email;
            homeScreen.classList.add('hidden');
            emailDetailsScreen.classList.remove('hidden');
            
            // Show a loading state in content area
            emailContent.innerHTML = '<p class="text-center text-gray-500 dark:text-gray-400 py-8">Loading message...</p>';

            try {
                // Fetch full email details using its ID
                const response = await fetch(`https://api.mail.tm/messages/${email.id}`, {
                    headers: { 'Authorization': `Bearer ${jwtToken}` }
                });

                if (response.ok) {
                    const fullEmail = await response.json();
                    const date = new Date(fullEmail.createdAt);
                    const dateString = date.toLocaleDateString('en-US', { 
                        year: 'numeric', 
                        month: 'short', 
                        day: 'numeric' 
                    });
                    const timeString = date.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit' 
                    });

                    // Create email content with proper formatting and overflow handling
                    let emailContentHTML = `
                        <div class="max-w-3xl mx-auto bg-white dark:bg-slate-800 rounded-xl shadow-lg overflow-hidden">
                            <div class="p-4 border-b border-gray-200 dark:border-slate-700">
                                <div class="flex items-start mb-3">
                                    <div class="w-10 h-10 rounded-full bg-amber-100 dark:bg-amber-900/30 flex items-center justify-center mr-3 flex-shrink-0">
                                        <span class="text-amber-800 dark:text-amber-300 font-medium text-lg">${fullEmail.from?.name ? fullEmail.from.name.charAt(0).toUpperCase() : (fullEmail.from?.address || '').charAt(0).toUpperCase()}</span>
                                    </div>
                                    <div class="flex-1 min-w-0">
                                        <p class="font-medium text-gray-900 dark:text-gray-100 truncate">${fullEmail.from?.name || fullEmail.from?.address || 'Unknown Sender'}</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400 truncate">${fullEmail.from?.address || ''}</p>
                                    </div>
                                </div>
                                <h2 class="text-xl font-bold text-gray-900 dark:text-gray-100 mb-1 break-words">${fullEmail.subject || '(No Subject)'}</h2>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${dateString} at ${timeString}</p>
                            </div>
                            <div class="p-4 email-content-container max-h-[60vh] overflow-y-auto">
                    `;

                    // Process email content safely
                    let emailBody = '';
                    if (fullEmail.html) {
                        // Use a safer approach for HTML content
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = fullEmail.html;
                        
                        // Basic sanitization - remove scripts and iframes
                        Array.from(tempDiv.getElementsByTagName('script')).forEach(el => el.remove());
                        Array.from(tempDiv.getElementsByTagName('iframe')).forEach(el => el.remove());
                        Array.from(tempDiv.getElementsByTagName('style')).forEach(el => el.remove());
                        Array.from(tempDiv.getElementsByTagName('form')).forEach(el => el.remove());
                        
                        emailBody = tempDiv.innerHTML;
                    } else if (fullEmail.text) {
                        // Convert plain text to HTML with line breaks
                        emailBody = fullEmail.text.replace(/\n/g, '<br>')
                    } else {
                        emailBody = '(No content)';
                    }
                    
                    // Add the email body to the HTML
                    emailContentHTML += `
                                <div class="prose prose-gray dark:prose-invert max-w-none text-gray-800 dark:text-gray-200">
                                    ${emailBody}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    emailContent.innerHTML = emailContentHTML;
                    
                    // Apply additional styling to links within the email content
                    setTimeout(() => {
                        const emailLinks = document.querySelectorAll('.email-content-container a');
                        emailLinks.forEach(link => {
                            link.classList.add('text-blue-600', 'dark:text-blue-400', 'underline', 'hover:text-blue-800', 'dark:hover:text-blue-300');
                            link.target = '_blank';
                            link.rel = 'noopener noreferrer';
                        });
                    }, 100);
                    
                } else {
                    showToast('Failed to load email details', 'error');
                    emailContent.innerHTML = '<p class="text-center text-red-500 dark:text-red-400 py-8">Error: Could not load message.</p>';
                }
            } catch (error) {
                console.error('Error fetching email details:', error);
                showToast('Failed to load email details', 'error');
                emailContent.innerHTML = '<p class="text-center text-red-500 dark:text-red-400 py-8">Error: Could not load message.</p>';
            }
        }

        async function deleteCurrentMessage() {
            if (!currentEmailDetails || !jwtToken) return;
            
            try {
                const response = await fetch(`https://api.mail.tm/messages/${currentEmailDetails.id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${jwtToken}` }
                });

                if (response.ok) {
                    showToast('Message deleted', 'success');
                    // Refresh email list and go back to home screen
                    await fetchEmails();
                    showHomeScreen();
                } else {
                    showToast('Failed to delete message', 'error');
                }
            } catch (error) {
                console.error('Error deleting message:', error);
                showToast('Failed to delete message', 'error');
            }
        }

        function copyToClipboard() {
            const emailToCopy = currentEmail || (emailAddress ? emailAddress.textContent : '');
            
            if (!emailToCopy || emailToCopy === 'Loading...' || emailToCopy === 'No email') {
                showToast('No email to copy', 'error');
                return;
            }
            
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(emailToCopy).then(() => {
                    showToast('Copied to clipboard', 'success');
                }).catch(err => {
                    console.error('Clipboard API failed:', err);
                    fallbackCopyToClipboard(emailToCopy);
                });
            } else {
                fallbackCopyToClipboard(emailToCopy);
            }
        }

        function fallbackCopyToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                const msg = successful ? 'Copied to clipboard' : 'Failed to copy';
                const type = successful ? 'success' : 'error';
                showToast(msg, type);
            } catch (err) {
                console.error('Fallback copy failed:', err);
                showToast('Failed to copy', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        function getEmailPreview(content) {
            // Strip HTML tags if content is HTML
            const textContent = content ? content.replace(/<[^>]*>/g, '') : '';
            return textContent.length > 100 ? textContent.substring(0, 100) + '...' : textContent;
        }

        function showToast(message, type = 'info') {
            if(!toastContainer) return;
            const toast = document.createElement('div');
            const bgColor = 
                type === 'success' ? 'bg-green-600' : 
                type === 'error' ? 'bg-red-600' : 
                type === 'warning' ? 'bg-yellow-600' : 
                'bg-gray-800';
            toast.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg mb-2 max-w-xs text-center`;
            toast.textContent = message;
            toastContainer.appendChild(toast);
            setTimeout(() => {
                if (toastContainer.contains(toast)) {
                    toastContainer.removeChild(toast);
                }
            }, 3000);
        }
    </script>
</body>
</html>
